FROM ubuntu:24.04

RUN apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y \
  git python3 python3-pip scons curl unzip make g++ zlib1g-dev \
  && apt-get clean


# ---------------------------
# Build makensis for Linux
# ---------------------------
WORKDIR /build
RUN git clone --depth=1 https://github.com/kichik/nsis.git nsis-src

WORKDIR /build/nsis-src
RUN scons SKIPSTUBS=all SKIPPLUGINS=all ZLIB_LINUX=1  && \
  mkdir -p /out/linux && \
  cp build/urelease/makensis /out/linux/makensis

# ---------------------------
# Download makensis for Windows
# ---------------------------
RUN curl -L -o nsis.zip https://sourceforge.net/projects/nsis/files/NSIS%203/3.11/nsis-3.11.zip/download && \
  unzip nsis.zip -d nsis-win && \
  curl -L -o strlen_patch.zip https://sourceforge.net/projects/nsis/files/NSIS%203/3.11/nsis-3.11-strlen_8192.zip/download && \
  unzip -o strlen_patch.zip -d nsis-win && \
  mkdir -p /out/windows && \
  cp -a nsis-win/* /out/windows/
