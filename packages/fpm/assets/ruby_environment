#!/bin/bash
set -e

ROOT=`dirname "$0"`
ROOT=`cd "$ROOT/.." && pwd`

# This script is used to set up the environment for Ruby applications.
# It sets up the necessary environment variables and paths for Ruby to run correctly.

echo ORIG_LD_LIBRARY_PATH=\"$LD_LIBRARY_PATH\"
echo ORIG_SSL_CERT_DIR=\"$SSL_CERT_DIR\"
echo ORIG_SSL_CERT_FILE=\"$SSL_CERT_FILE\"
echo ORIG_RUBYOPT=\"$RUBYOPT\"
echo ORIG_RUBYLIB=\"$RUBYLIB\"

# Set up the environment variables for Ruby
echo LD_LIBRARY_PATH=\"$LD_LIBRARY_PATH:$ROOT/lib\"

echo SSL_CERT_FILE=\"$ROOT/lib/ca-bundle.crt\"
echo RUBYOPT=\"-r$ROOT/lib/restore_environment\"
for DIR in ""$ROOT"/lib/ruby/gems/*/deplibs/*/*"; do
	echo LD_LIBRARY_PATH=\"\$LD_LIBRARY_PATH:$DIR\"
done
echo GEM_HOME="$ROOT/lib/ruby/gems/RUBY_VERSION"
echo GEM_PATH="$ROOT/lib/ruby/gems/RUBY_VERSION"
echo RUBYLIB=\"$ROOT/lib/ruby/RUBY_VERSION:$ROOT/lib/ruby/lib/ruby/gems/RUBY_VERSION/gems/did_you_mean-1.0.0/lib:$ROOT/lib/ruby/site_ruby/RUBY_VERSION:$ROOT/lib/ruby/site_ruby/RUBY_VERSION/i686-linux:$ROOT/lib/ruby/site_ruby:$ROOT/lib/ruby/vendor_ruby/RUBY_VERSION:$ROOT/lib/ruby/vendor_ruby/RUBY_VERSION/i686-linux:$ROOT/lib/ruby/vendor_ruby:$ROOT/lib/ruby/RUBY_VERSION:$ROOT/lib/ruby/RUBY_VERSION/i686-linux\"
# echo GEM_HOME="$ROOT/lib/ruby/lib/ruby/gems/RUBY_VERSION"
# echo GEM_PATH="$ROOT/lib/ruby/lib/ruby/gems/RUBY_VERSION"
# echo RUBYLIB=\"$ROOT/lib/ruby/lib/ruby/RUBY_VERSION:$ROOT/lib/ruby/lib/ruby/gems/RUBY_VERSION/gems/did_you_mean-1.0.0/lib:$ROOT/lib/ruby/site_ruby/RUBY_VERSION:$ROOT/lib/ruby/site_ruby/RUBY_VERSION/i686-linux:$ROOT/lib/ruby/site_ruby:$ROOT/lib/ruby/vendor_ruby/RUBY_VERSION:$ROOT/lib/ruby/vendor_ruby/RUBY_VERSION/i686-linux:$ROOT/lib/ruby/vendor_ruby:$ROOT/lib/ruby/RUBY_VERSION:$ROOT/lib/ruby/RUBY_VERSION/i686-linux\"

# backup original environment variables for `restore_environment.rb`
echo export ORIG_LD_LIBRARY_PATH
echo export ORIG_SSL_CERT_DIR
echo export ORIG_SSL_CERT_FILE
echo export ORIG_RUBYOPT
echo export ORIG_RUBYLIB

# prepare to execute ruby command
echo export LD_LIBRARY_PATH
echo unset  SSL_CERT_DIR
echo export SSL_CERT_FILE
echo export RUBYOPT
echo export GEM_HOME
echo export GEM_PATH
echo export RUBYLIB
