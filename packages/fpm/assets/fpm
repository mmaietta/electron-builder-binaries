#!/bin/bash
set -e

# Figure out where this script is located.
SELFDIR="$(cd "$(dirname "$0")" && pwd)"

RUBY_ROOT=$SELFDIR/lib/portable-ruby
export GEM_HOME="$RUBY_ROOT/GEM_DIR" # GEM DIR var replaced with copied dir using `sed` in `build.sh`
export GEM_PATH="$GEM_HOME"
export PATH="$RUBY_ROOT/bin:$GEM_HOME/bin:$PATH"
export RUBYOPT='-W:no-deprecated'

# Tell Bundler where the Gemfile and gems are.
export BUNDLE_GEMFILE="$SELFDIR/lib/vendor/Gemfile"
unset BUNDLE_IGNORE_CONFIG

# Run the actual app using the bundled Ruby interpreter, with Bundler activated.
exec "$RUBY_ROOT/bin/ruby" -rbundler/setup "$SELFDIR/lib/app/bin/fpm" "$@"